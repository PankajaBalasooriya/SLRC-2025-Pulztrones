#include "tasks.h"
#include "sensors.h"
#include "robot.h"
#include "buzzer.h"


// Initialize task status globally


// Function to update task status


//---------Start 0f Plantation Task (Collect and identify potatoes)---------------------
void executePlantationTask(void) {
	Robot_MoveForwardUntillLine();
	Robot_TurnLeft90Inplace();

	//Start the task
	LineColor linecolor;
	BallColor ballcolor;
	for(uint8_t column = 0; column < 5; column ++){
		for(uint8_t row = 0; row < 4; column ++){
				if(row == 0){
					linecolor = RPI_GetLineColor(column, row);
					moveToCenterofCellinZeroRow();

					if(linecolor == GREEN){
						Robot_TurnLeft90Inplace();



						moveToCenterofNextColumnfromFirstRow();
						HAL_Delay(MOTION_DELAY);
						break;
					}
				}
				else if(row == 1){
					linecolor = RPI_GetLineColor(column, row);
					moveToCenterofNextCell();

					if(linecolor == GREEN){

					}
				}

		}

	}

	moveToCenterofNextCell();
	HAL_Delay(750);

	Robot_TurnLeft90Inplace();
	//Picking the ball

	HAL_Delay(750);

	Robot_TurnLeft90Inplace();

	HAL_Delay(750);

	Robot_LineFollowUntillJunction();

	HAL_Delay(750);

	Robot_TurnRight90Inplace();

	Robot_LineFollowUntillJunction();







	// Detect color for the next using cv
//	for(uint8_t column = 0; column < 5; i ++){
//
//	}

}

void moveToCenterofNextCell(){
	Robot_LineFollowUntillJunctionAndNotStop();
	Robot_FollowLineGivenDistance(170);
}

void moveToCenterofCellinZeroRow(){
	Robot_LineFollowUntillJunction();
	HAL_Delay(MOTION_DELAY);
	Robot_TurnRight90Inplace();
	HAL_Delay(MOTION_DELAY);
	Robot_FollowLineGivenDistance(170);
	HAL_Delay(MOTION_DELAY);
}

void moveToCenterofNextColumnfromFirstRow(){
	moveToCenterofCellinZeroRow();
}

void moveToCenterofNextColumnfromSecondRow(){
	moveToCenterofNextCell();
	HAL_Delay(MOTION_DELAY);
	moveToCenterofNextColumnfromFirstRow();
}

void moveToCenterofNextColumnfromThiredRow(){
	moveToCenterofNextCell();
	HAL_Delay(MOTION_DELAY);
	moveToCenterofNextColumnfromSecondRow();
}

BallColor picktheBall(uint8_t column, uint8_t row){
	ballcolor = RPI_GetBallColor(column, row);
	HAL_Delay(MOTION_DELAY);
	//ToDo: Pick The box
	Buzzer_Toggle(1000);
	HAL_Delay(MOTION_DELAY);

	return BallColor;
}


//---------end 0f Plantation Task (Collect and identify potatoes)---------------------

// Task manager function
void runCurrentTask(TaskType task) {

    switch (task) {
        case TASK_PLANTATION:
            executePlantationTask();
            break;
        default:

            break;
    }

    // Print final status after execution

}
